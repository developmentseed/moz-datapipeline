## Road Planning data pipeline
This repository contains the data pipeline that prepares Vector Tiles for use by the [Road Planning Tool](https://github.com/developmentseed/moz-road-planning).

### Usage
Run the pipeline using:

```
docker-compose up
```

If you make a change to one of the scripts, run the following to rebuild the image and run the pipeline again:


```
docker-compose up --build
```


### Repository structure

- `/scripts` contains the scripts needed to produce the final Vector Tiles
- `/source` contains the input data for the pipeline
- `/output` contains the files generated by the pipeline

### Calculating indicators
The scripts to calculate the different indicators (poverty rate, agriculture potential, etc) are stored in the `/scripts` folder. The data pipeline is not opinionated about what language to use and depending on the indicator being calculated, scripts may be written in `node`, `python`, or `bash`. When developing new scripts, please use the following guidelines:

- the input data for the scripts is stored in the `./source` folder
- a script writes the final indicator to a CSV file in the `./output` folder. The requirements for these files are:  
  - the file contains two columns: `way_id` and `score`. Any additional columns are ignored by the data pipeline.
  - the value for `score` should normalizes throughout the indicators and be between 0 and 100.
  - each file contains the value for one indicator. If the script calculates multiple indicators for each road segment, these need to be stored in separate files.
  - the CSV file needs to be named after the indicator. The data pipeline will use the basename of the CSV file (without extension) as the name of the attribute in the final Vector Tiles
- temporary data can be written to the `./tmp` folder. This will be created on start of the data pipeline, and cleaned up on finish
- individual scripts may fail, but should not fail the full pipeline. If a script fails, print a friendly error message to the user so they understand which indicator is not present in the final dataset
